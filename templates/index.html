<!DOCTYPE html>
<html>
<head>
    <title>AGV Control</title>
    <style>
        #videoCanvas {
            border: 1px solid black;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <h1>AGV Control</h1>
    <div>
        <canvas id="videoCanvas" width="640" height="480"></canvas>
    </div>
    <div>
        <button id="forward">Forward</button>
        <button id="backward">Backward</button>
        <button id="left">Left</button>
        <button id="right">Right</button>
        <button id="stop">Stop</button>
    </div>

    <script>
        const socket = io();
        const canvas = document.getElementById('videoCanvas');
        const context = canvas.getContext('2d');
        const img = new Image();

        img.onload = () => {
            context.drawImage(img, 0, 0);
        };

        img.src = "{{ url_for('video_feed') }}";

        // Gửi lệnh điều khiển
        document.getElementById('forward').addEventListener('click', () => {
            socket.emit('control', 'forward');
        });
        document.getElementById('backward').addEventListener('click', () => {
            socket.emit('control', 'backward');
        });
        document.getElementById('left').addEventListener('click', () => {
            socket.emit('control', 'left');
        });
        document.getElementById('right').addEventListener('click', () => {
            socket.emit('control', 'right');
        });
        document.getElementById('stop').addEventListener('click', () => {
            socket.emit('control', 'stop');
        });

        // Xử lý click trên canvas (lấy tọa độ)
        canvas.addEventListener('click', (event) => {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            console.log("Clicked at: x=" + x + ", y=" + y);

            // Gửi tọa độ lên server
            fetch('/map_click', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'x=' + x + '&y=' + y
            });
        });


    </script>
</body>
</html>
